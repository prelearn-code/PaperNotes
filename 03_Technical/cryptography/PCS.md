# 一、PCS-PLONK
---
## 1、理论层：PLONK 式批量聚合机制

**1. Setup：通用的结构化参考串 (SRS)**
- **输入/输出**：输入 $\lambda$ $\rightarrow$ 输出 $(pk, sk)$。
- **核心机制**：与标准 KZG 完全一致，生成 $pk = (g, g^\alpha, \dots, g^{\alpha^{s-1}})$。
- **理论作用**：PLONK 不需要为每个多项式重新 Setup，所有多项式共用同一套“Powers of Tau”参数。

**2. Commit：多项式向量的独立锁定**
- **输入/输出**：输入多项式列表 $(f_1, f_2, \dots, f_k)$ $\rightarrow$ 输出承诺列表 $(C_1, C_2, \dots, C_k)$。
- **核心机制**：Prover 对每一个多项式单独计算 $C_i = g^{f_i(\alpha)}$。
- **理论作用**：虽然多项式是独立的，但它们被绑定在同一个 $\alpha$ 空间下，为后续的“线性组合聚合”提供了代数基础。

**3. CreateWitness：随机线性组合（RLC）聚合**
- **解决痛点**：验证 $k$ 个多项式若需要 $k$ 个 Witness，开销太大。
- **核心机制**：
  - **引入随机数**：Verifier 提供一个随机挑战数 $v$（作为权重）。
  - **聚合多项式**：构造 $h(X) = \sum_{i=1}^k v^{i-1} \cdot (f_i(X) - y_i)$。
  - **构造商多项式**：$q(X) = \frac{h(X)}{X - z}$。
  - **生成唯一 Witness**：$W = g^{q(\alpha)}$。
- **理论作用**：利用**施瓦茨-齐佩尔引理 (Schwartz-Zippel Lemma)**。如果聚合后的多项式 $h(X)$ 能被 $(X-z)$ 整除，那么极大概率所有原始 $f_i(X)$ 都能通过验证。

**4. VerifyEval：一次性批量校验**
- **输入/输出**：输入 $pk, z, (C_1, \dots), (y_1, \dots), W, v$ $\rightarrow$ 0/1。
- **核心机制**：Verifier 先在群上模拟聚合承诺 $C_{agg} = \sum v^{i-1} C_i$，然后进行单次配对验证。
- **理论作用**：将 $k$ 次昂贵的配对操作压缩为 **1 次**。这是 PLONK 证明极小的核心原因。

## 2、实例层：直觉式极简推演

**1. Setup 阶段**
- **秘密设定**：$\alpha = 10$（上帝视角）。
- **公开公钥**：$pk = (g, g^{10}, g^{100}, \dots)$。
- **直觉**：通用的“刻度尺”，谁都能用。

**2. Commit 阶段**
- **假设数据**：Prover 有两个多项式：
  - $f_1(X) = X$
  - $f_2(X) = 2X$
- **计算承诺**：
  - $C_1 = g^{10}$
  - $C_2 = g^{20}$
- **直觉**：两个多项式分别打包，还没发生关联。

**3. CreateWitness 阶段（聚合魔法）**
- **挑战情景**：在点 $z=3$ 处验证。
  - $y_1 = f_1(3) = 3$
  - $y_2 = f_2(3) = 6$
- **引入随机权重**：Verifier 扔出一个随机数 $v=2$。
- **聚合计算**（Prover 视角）：
  - 目标是证明 $(f_1 - 3)$ 和 $(f_2 - 6)$ 都在 $X=3$ 处为 0。
  - 加权合并：$h(X) = (X - 3) + \mathbf{2} \cdot (2X - 6)$
  - 化简 $h(X)$：$X - 3 + 4X - 12 = 5X - 15 = 5(X - 3)$。
- **生成商与 Witness**：
  - $q(X) = \frac{5(X-3)}{X-3} = 5$。
  - $W = g^{q(\alpha)} = g^5$。
- **直觉**：不管有多少个多项式，最后都揉成了一团面（$W$），只要这团面没问题，原来那些面条就都没问题。

**4. VerifyEval 阶段**
- **验证逻辑**：Verifier 自己算聚合承诺，然后验 $W$。
- **Verifier 的计算**：
  - 聚合承诺：$C_{agg} = C_1 \cdot C_2^v = g^{10} \cdot (g^{20})^2 = g^{50}$。
  - 聚合值：$y_{agg} = y_1 + v \cdot y_2 = 3 + 2(6) = 15$。
- **最终配对检查**（指数层面）：
  - $C_{agg} - y_{agg} \stackrel{?}{=} W \cdot (\alpha - z)$
  - $50 - 15 \stackrel{?}{=} 5 \cdot (10 - 3)$
  - $35 = 35$。
- **直觉**：验证通过。Verifier 确信 $f_1$ 和 $f_2$ 都是真的，且一次性搞定。

### 附：四阶段统一对照表
|**阶段**|**理论本质**|**例子中的直觉**|
|---|---|---|
|**Setup**|生成通用 SRS|准备一把公用尺子|
|**Commit**|独立承诺|多项式 $\rightarrow$ 一堆箱子 $(C_1, C_2)$|
|**CreateWitness**|**随机线性组合 (RLC)**|加权打包：$Box_1 + 2 \cdot Box_2$|
|**VerifyEval**|批量验证聚合结果|拆开打包后的这一个箱子，全对|
# 二、PCS-MPAP
---
## 2.1、理论层：单点 PCS 核心机制

**1. Setup：构建基于 $\alpha$ 的陷门环境**
- **输入/输出**：输入安全参数 $\lambda$ $\rightarrow$ 输出 $(pk, sk)$。
- **核心机制**：生成群 $G$ 的生成元 $g$ 和一个随机秘密值 $\alpha$（即 $sk$）。
- **公钥结构**：$pk = (g, g^\alpha, g^{\alpha^2}, \dots, g^{\alpha^{s-1}})$。这是经典的“Powers of Tau”结构。
- **理论作用**：将秘密 $\alpha$ 的不同幂次“加密”后公开，允许 Prover 在不知道 $\alpha$ 的情况下计算 $f(\alpha)$ 的加密值。

**2. Commit：多项式的代数绑定**
- **输入/输出**：输入 $pk, f(X)$ $\rightarrow$ 输出承诺 $C$。
- **核心机制**：Prover 利用 $pk$ 计算 $C = g^{f(\alpha)}$。
- **理论作用**：利用同态性质，将多项式 $f(X)$ 在秘密点 $\alpha$ 处求值并映射到群上。由于离散对数难题，Prover 无法找到另一个多项式 $f'(X)$ 产生相同的 $C$，从而实现“绑定”。
**3. CreateWitness：商多项式的存在性证明**
- **输入/输出**：输入 $pk, f(X), r$ $\rightarrow$ 输出证据 $W$。
- **核心机制**：
  - 计算商多项式：$\psi(X) = \frac{f(X) - f(r)}{X - r}$。根据多项式余数定理，只有当 $f(r)$ 是真实评估值时，$\psi(X)$ 才是一个整多项式（无余数）。
  - 计算 Witness：$W = g^{\psi(\alpha)}$。
- **理论作用**：$W$ 是“商多项式存在”的加密证明。它证明了 $(f(X) - f(r))$ 能被 $(X - r)$ 整除。

**4. VerifyEval：双线性配对校验**
- **输入/输出**：输入 $pk, r, C, W$（以及声称的值 $y=f(r)$） $\rightarrow$ 输出 0/1。
- **核心机制**：验证者通过双线性配对（Pairing）检查等式：$e(C \cdot g^{-f(r)}, g) \stackrel{?}{=} e(W, g^\alpha \cdot g^{-r})$。
- **理论作用**：这是在群上验证代数关系 $(f(\alpha) - f(r)) = \psi(\alpha) \cdot (\alpha - r)$ 是否成立。如果成立，说明 Prover 没有撒谎。

## 2.2、实例层：极简直觉演示（单点版）

**1. Setup 阶段**
- **秘密设定**：系统选定秘密 $\alpha = 7$（除了上帝无人知晓）。
- **公开公钥**：发布 $pk = (g, g^7, g^{49}, \dots)$。
- **直觉**：$\alpha=7$ 是用来冻结多项式的“核心钉子”。

**2. Commit 阶段**
- **假设数据**：Prover 有一个多项式 $f(X) = 3 + 2X$。
- **计算承诺**：利用 $pk$ 计算 $f(\alpha)$ 的群形式。
  - 指数计算：$f(7) = 3 + 2(7) = 17$。
  - 输出：$C = g^{17}$。
- **直觉**：多项式被压缩成了 $g^{17}$，承诺已锁定。

**3. CreateWitness 阶段**
- **挑战情景**：Verifier 想验证 $r=5$ 时，函数值是否为 $13$。
- **计算商多项式**：
  - $\psi(X) = \frac{f(X) - f(r)}{X - r} = \frac{(3+2X) - 13}{X - 5} = \frac{2X - 10}{X - 5} = 2$。
  - 此处商多项式 $\psi(X)$ 恰好是常数 2。
- **生成 Witness**：
  - $W = g^{\psi(\alpha)} = g^{\psi(7)} = g^2$。
- **直觉**：Prover 发送 $W=g^2$，意思是“我把整除后的结果给你算好了”。

**4. VerifyEval 阶段**
- **验证逻辑**：Verifier 检查“除法关系”在加密状态下是否成立。
- **代数检查**（指数层面）：
  - 左边：$C - f(r) = 17 - 13 = 4$。
  - 右边：$W \cdot (\alpha - r) = 2 \cdot (7 - 5) = 2 \cdot 2 = 4$。
- **直觉**：左右两边相等，验证通过。Verifier 确信 $f(5)=13$ 是真的，且来自于承诺 $C$。

### 附：四阶段统一对照表
| **阶段** | **理论本质** | **例子中的直觉** |
|---|---|---|
| **Setup** | 生成秘密参数 $\alpha$ | 埋下一个秘密数字 7 |
| **Commit** | $C = g^{f(\alpha)}$ | 多项式 $\rightarrow$ 一个数 $g^{17}$ |
| **CreateWitness** | 构造商多项式 $\psi(X)$ | 算出除法结果 $W=g^2$ |
| **VerifyEval** | 验证双线性配对 | 确认 $4 = 2 \times 2$，整除成立 |
