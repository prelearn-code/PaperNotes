---
title: Enabling Verifiable Search and Integrity Auditing in Encrypted Decentralized Storage Using One Proof
year: 2024
venue: CVPR
field:
  - Authentication
  - Integrity
  - Crypto/Searchable Encryption
pdf: "[[Enabling Verifiable Search and Integrity Auditing in Encrypted Decentralized Storage Using One Proof.pdf]]"
Read_date: 2025-10-10
detailes: "[[../../02_Projects/Enabling Verifiable Search and Integrity Auditing  in Encrypted Decentralized Storage Using  One Proof/notes/设计方案]]"
---
# 方法

本文通过将 **搜索验证与完整性审计统一到一个证明中** 的技巧性结构设计，将原本需要分别进行的两类验证操作合并，大幅降低 DSN 场景下的链上开销与节点计算成本，实现加密条件下的高效可验证搜索与完整性审计。同时设计状态链信息，来保证文件更新的前向安全性。

# 主要贡献

## 安全性贡献


## 实验贡献

# 主要问题

1. **仅支持单关键词搜索**：当前仅支持 single-keyword，复杂查询（如相似性检索、多条件搜索）无法直接扩展。
2. **依赖链式状态结构**：搜索时必须遍历状态链，若同一关键词关联文件过多，检索延迟会增长；
3. **未处理访问模式泄露问题**：仍需引入 dummy 技术才能应对频率分析与访问模式攻击；
4. **需要节点额外执行搜索证明**：相比传统 PoS 仅验证完整性，本方案对资源较弱的节点仍存在一定额外负担。




# 论文
**论文真问题**  
在区块链驱动的去中心化加密存储网络中，现有方案要么仅支持完整性审计要么仅支持可验证搜索且各自使用独立证明，导致链上存储与计算开销高并缺乏前向安全的动态更新能力，本文构造一个单一证明体系，在一次验证中同时保证搜索结果正确性与被搜文件完整性，并控制链上开销在可接受范围内。

---

**方案背景**

- 领域瓶颈：
    
    1. **功能割裂+链上负担过重**：既有 DSN 方案分别针对 PoS 审计或可验证搜索单独设计，无法在同一机制下同时验证搜索结果与文件完整性；Cai 等方案为保证搜索可验证性，引入“仲裁服务器集群”存储索引并重放搜索，这既违反 DSN 的去中心化原则，又增加额外服务器与链上记录负担。 文中基于 Cai+[12] 与两类审计方案组合成 baseline1/baseline2，对比表明：由于这两条基线需要将索引中每个条目的哈希写入链上，其数据外包阶段的 gas 成本远高于本文方案（Fig.3(c) 中三条曲线差距显著）。
        
    2. **动态更新与前向安全缺位**：现有 DSN 审计工作大多为静态 PoS，用户在初始化后难以进行动态更新；少数支持动态更新的工作仅关注完整性审计，不考虑前向安全的可搜索加密约束。本文指出：在 DSN 场景中所有“存/删”事件需永久记录在链上，因此在同时支持可验证搜索与完整性审计时，必须特别控制链上存储开销；同时在插入新文件时需要保证前向安全，即新插入文件不能与过去搜索建立可见关联。
        
- 作者动机：
    
    1. 在 **不引入任何第三方仲裁服务器** 的前提下，为 DSN 设计一套原生协议，使存储节点用一份统一证明就能让其他节点公开验证“搜索结果是否完备且正确”和“返回文件是否完好”。
        
    2. 在该统一证明框架下，**最小化链上数据**：仅上传必要的公共参数、搜索请求、文件标识符与聚合证明，而不将大规模索引结构搬上链，从而适应 DSN 极其有限的 on-chain 存储资源。
        
    3. 支持 **文件插入与删除等动态操作** 时仍满足前向安全：新插入文件的关键字关联信息不能被存储节点利用来回溯过去的查询模式或构造文件注入型攻击。
        

---

**创新点**

1. **[核心] 统一的关键字关联证明（keyword-associated proof）**：
    
    - 技术内容：
        
        - 为每个文件和关键字构造关键字关联标签 (kt_w)，其内部同时绑定文件标识 (ID_F)、搜索令牌 (T) 以及关键字状态 (st)，并用与一般完整性标签相同的私钥 (sk) 进行指数签名。插入多个包含同一关键字的文件时，通过在标签中串接“当前状态”和“前一状态”将这些文件按插入时间构成状态链。
            
        - 在搜索阶段，存储节点对所有匹配文件的完整性标签 (TS_F)、关键字关联标签 (kt_w) 和聚合明文块线性组合 ((w_a)) 做乘法聚合，得到单个标量与群元素集合 $((u, f_1, f_2, f_3, q))$，并通过单次配对等式  
            [  
            $e(f_3,g) \stackrel{?}{=} e(f_1\cdot f_2\cdot H_2(st_d|T)\cdot \mu^q, pk)$  
            ]  
            同时验证搜索结果完备性和返回文件完整性。
            
    - 突破性：将传统 PoR 中按文件生成的完整性证明与可搜索加密中的结果正确性证明合并为**一个聚合证明 + 一次配对验证**，避免为搜索和审计分别上传与验证两套证明，直接降低链上存储和链下验证成本。
        
    - 关键证据：
        
        - 设计描述与正确性证明见 Section III-A/III-B（Fig.1 给出三文件同关键字的实例）与 Section IV-A.3 的配对推导式 (9)。
            
        - Fig.4(b)(c)(d) 实验表明，相比 baseline1/baseline2，在同样搜索次数下，存储节点生成证明时间和其他节点验证时间显著降低，且单次搜索的链上 gas 成本明显更小。
            
2. **[核心] 状态关联 token + 加密指针链实现前向安全的动态索引**：
    
    - 技术内容：
        
        - 为关键字 (w) 维护一条**隐藏状态链** ((st_1,\dots,st_d))，仅客户端掌握最新状态集合 (SS(w))。插入含关键字 (w) 的新文件时，客户端选择全新状态 (st_d)，计算搜索令牌 (T = SE.Enc(m_k,w))，再计算状态关联 token (T^{(d)} = H_2(T|st_d)) 作为索引键。
            
        - 同时计算“加密指针” $(ptr^{(d-1)} = SE.Enc(H_3(st_d), st_{d-1}))$，记录在索引条目中，使存储节点在搜索时从最新状态出发，通过依次解密指针恢复前一状态并生成对应 (T^{(a)})，从而按链式遍历获取所有历史文件。
            
    - 突破性：
        
        - **前向安全**：存储节点看不到真实状态值，也无法反推出最新状态 (st_d)，因此无法将新的状态关联 token 与历史搜索请求建立唯一对应关系；即使掌握所有旧状态和搜索 token，也缺乏计算新 token 的输入。Section IV-B.2 形式化证明了在每次插入均选新状态的前提下，对手无法将新文件与过往查询关联。
            
        - **完备召回**：通过加密指针链使得仅凭“当前状态+搜索令牌”即可还原整个状态序列，从而遍历所有包含该关键字的文件，无需客户端维护完整历史状态列表。
            
    - 关键证据：状态链与指针结构在 Fig.1 与 Section III-A/III-B.5 的检索算法描述中给出，前向安全性在 Section IV-B.2 中给出形式化论证。
        
3. **[辅助] DSN 友好的审计分层：搜索内联审计 + 普通 PoS 分工**
    
    - 技术点：
        
        - 对**在当前审计周期内被搜索过的文件**，其完整性由关键字关联证明一并验证；
            
        - 对**未被搜索的文件**，仍通过传统 PoR 式证明 (Proof(ID_F) = (w,u)) 和单独配对等式 (10) 进行验证。
            
    - 效果：避免为所有文件都生成“搜索型”证明，同时又不重复验证已在搜索证明中覆盖的文件，实现审计负载在不同类型证明之间的分摊。
        
    - 关键证据：流程划分与对应算法在 Section III-B.6–7 以及系统工作流小节中给出。
        
4. **[辅助] 面向链上资源约束的轻量 on-chain 设计与评估**
    
    - 技术点：
        
        - 链上仅存储：公共参数 (PP)、客户端公钥 (pk)、搜索请求 ((T,st_d))、搜索结果及聚合证明，以及按周期上传的未搜索文件的 PoR 证明；索引数据库和明文数据全部保留在存储节点。
            
    - 效果：在保证公开可验证性的前提下，避免 baseline1/baseline2 需要为索引中每一项上传哈希值的做法，明显降低数据外包与搜索阶段的 gas 成本。Fig.3(c)、Fig.4(d) 中三种方案 gas 曲线对比直接体现这一点。
        

---

**方案架构**

- 核心流程（按 Definition 2 给出的算法序列）：
    
    1. **Setup**：存储节点运行复合阶双线性参数生成器得到 ((p,q,N,G_1,G_2,e))，选生成元 (g\in G_1) 与随机元素 (l\in G_1)，定义哈希函数 (H_1,H_2,H_3) 与伪随机函数 (p)，发布公共参数 (PP={N,g,l}) 及函数族。
        
        - 输入：安全参数 (j)
            
        - 输出：公共参数 (PP)
            
    2. **KeyGen**：客户端选取整数 $(sk\in\mathbb{Z}_N)$ 和对称密钥 $(m_k,e_k)$，计算 $(pk=g^{sk})$ 并上链。
        
        - 输入：(PP)
            
        - 输出：私钥集 $(SK={m_k,sk,e_k})$，公钥 (pk)
            
    3. **Insert（文件外包）**：
        
        - 输入：明文文件 (F)、关键字集合 (W)、客户端私钥 (SK)、当前关键字状态集合 (SS)、索引数据库 (DB)
            
        - 处理：
            
            - 用 (e_k) 对每个块 (m_i) 做对称加密得到 (c_i)，整体记为 (C)；计算文件标识 (ID_F = H_1(C))。
                
            - 对每个块依据式 (2) 计算完整性标签 (r_i)，构成集合 (TS_F)。
                
            - 对每个关键字 (w_i)：生成搜索令牌 (T_i=SE.Enc(m_k,w_i))，选择新状态 (st_d)，构造状态关联 $token (T_i^{(d)})=H_2(T_i|st_d))$，以及状态指针 (ptr^{(d-1)}) 和关键字关联标签 (kt(w_i))（式 (3)/(4)）。
                
        - 输出：更新后的索引数据库 (DB')、状态集合 (SS')、密文 (C)、标签集合 (TS_F)。
            
    4. **Search（带证明的关键字搜索）**：
        
        - 输入：关键字 (w)、其最新状态 (SS(w)=st_d)、客户端私钥 (SK)、存储节点索引 (DB)、标签集合 (TS)。
            
        - 客户端侧：生成搜索令牌 (T = SE.Enc(m_k,w))，在区块链上发布 ((T,st_d))。
            
        - 存储节点侧：从 (T,st_d) 出发，反复
            
            - 计算 $(T^{(a)}=H_2(T|st_a))$，用作索引键在 (DB) 中取出条目 $((ptr^{(a-1)}, op, kt^{(w)}_a, ID_{F_a}))$，解密指针恢复上一个状态 $(st_{a-1})$；
                
            - 对每个有效文件根据式 (5) 生成 ((w_a,u_a))，并累积乘积 (u = \prod_{a\in AS} kt^{(w)}_a)；
                
            - 直到状态回到链首（检测到 (st_{a-1}=st_a)）。
                
        - 输出：搜索结果集合 (Res)、聚合证明集 (PS = {(ID_{F_a}, w_a, u_a)}_a \cup {u})，连同 ((T,st_d)) 上链。
            
    5. **Proof（常规 PoR 审计）**：对本审计周期内未被搜索的每个文件，根据式 (7) 生成 ((w,u)) 并与 (ID_F) 一起上链。
        
    6. **Verify.Search / Verify.Audit（公开验证）**：除证明生成节点以外的其他存储节点，利用 Eq.(8)(9)(10) 分别验证搜索结果与 PoR 证明。
        
- 关键设计机制
    
    1. **关键字状态链 + 加密指针链**：
        
        - 每个关键字维护一个仅客户端可见的最新状态 (st_d)；索引条目中保存的“状态指针”是用当前状态派生密钥 (H_3(st_a)) 加密的前一状态值。
            
        - 搜索时，存储节点只看到 ((T, st_d))，通过“计算状态关联 token → 取出指针 → 解密恢复前一状态”的循环恢复整个状态链，形成“按插入顺序的文件遍历路径”。整个过程不暴露真实状态，保证前向安全。
            
    2. **带关键字绑定的标签聚合**：
        
        - 完整性标签 (r_i) 通过把扇区密文 (c_{i,j}) 的指数嵌入群元素 (l) 中，并乘以哈希 (H_2(ID_F|i))，最后对整体取 (sk) 次幂实现。
            
        - 关键字关联标签 (kt(w)) 在此基础上额外乘以 (H_2(st|T)) 或 (H_2(st|T)/H_2(st_{prev}|T))，再统一取 (sk) 次幂，使得一旦关键字或状态链缺失，即使密文完整，也无法通过 Eq.(9) 的聚合验证。
            
    3. **一次配对验证“一网打尽”**：
        
        - 在验证端，通过 Eq.(8) 对所有返回文件的 $(u_a)、(kt(w)_a)$、块哈希和明文线性组合 (w_a) 做全局聚合，形成三个群元素 (f_1,f_2,f_3) 和一个标量 (q)，最后只需计算一次配对对比 (e(f_3,g)) 与 (e(f_1 f_2 H_2(st_d|T) l^q, pk))。
            
        - 若有任何文件缺失、被替换或与不同关键字绑定，则等式不成立，从而同时否定“搜索完备性”和“文件完整性”。这一点在 Section IV-A.3 的推导中严格给出。
            

---

**实验环境**

- 硬件：
    
    - 存储节点程序：Windows 笔记本，4 核 Intel Core i7-7560U，8GB 内存。
        
    - 客户端程序：Windows 笔记本，4 核 Intel Core i5-6200，8GB 内存。
        
    - 其他验证节点程序：MacOS 笔记本，4 核 Intel Core i5-1038NG7，16GB 内存。
        
    - 网络环境：同一 20 Mbps 带宽的无线局域网。
        
    - 区块链：基于 Ethereum，Solidity 智能合约在 Remix VM 部署测试，gas 上限 3000000。
        
    - 密码参数：安全参数位长 (j=512)，对称加密密钥位长 (i=256)。
        
- 数据集：基于 Enron 邮件公开数据集抽取三个子集（Table I）：
    
    - DB1：4108 封邮件 / 4108 个关键字–文件对 / 8.24 MB
        
    - DB2：12035 封 / 24070 对 / 25.83 MB
        
    - DB3：55064 封 / 165192 对 / 127.62 MB
        
- 基线对比方法：
    
    1. **Baseline1**：Cai 等在 DSN 上的 verifiable searchable encryption 方案 [12] + 经典 Merkle 树型 PoS 审计 [33]。作者说明 [33] 是多数实际 DSN 的基础审计模块。
        
    2. **Baseline2**：Cai 等方案 [12] + Du 等基于多项式承诺的 DSN 审计方案 [13]，后者在 DSN 场景实现最优的链上 gas 效率。
        
    3. 上述两条基线内部包含三个重要已知组件：
        
        - Cai 等 verifiable SSE for DSN（唯一直接面向 DSN 的可验证搜索方案）。
            
        - Ateniese 等 Merkle 树 PDP [33]（经典 PoS）。
            
        - Du 等 polynomial-commitment 审计 [13]（DSN 中 gas 成本最优）。
            
- 评估指标：
    
    - **主要指标**：
        
        - 时间开销：
            
            - Setup：单节点公共参数生成与上链时间（Fig.2(a)）。
                
            - Data Outsourcing：客户端与存储节点的计算时间和通信时间（Fig.3(a)(b)）。
                
            - Verifiable Search & Auditing：客户端发起搜索时间；存储节点生成统一证明时间；其他节点验证时间（Fig.4(a)(b)(c)）。
                
        - 链上 gas 成本：
            
            - Setup 阶段公共参数上链 gas（Fig.2(b)）。
                
            - 数据外包阶段文件与索引相关信息上链 gas（Fig.3(c)）。
                
            - 单次搜索和审计过程中搜索请求、文件标识与证明上链 gas（Fig.4(d)）。
                
    - **次要指标**：
        
        - 数据集规模（文件数、关键字–文件对数、总大小），用于观察方案在不同规模下的伸缩性。
            
- 关键结果（定量对比层面）
    
    1. **Setup**：
        
        - 本方案的 Setup 时间与 gas 成本均介于 baseline1 与 baseline2 之间；原因在于本方案上链的公共参数为“一个整数 + 两个群元素”，数量多于简单 Merkle 审计、少于多项式承诺方案。该过程仅执行一次，对整体效率影响可忽略（Fig.2）。
            
    2. **数据外包阶段**：
        
        - 客户端侧：
            
            - 计算时间主要由文件读写、对称加密以及标签生成组成；通信时间随文件数量线性增长，计算时间随关键字–文件对数增长。
                
            - 相比两条基线，本方案在三套数据集上均表现出更低的总时间开销，原因是基线方案需要为索引中每个条目的哈希值执行链上存储操作，增加了通信与等待开销（Fig.3(a)）。
                
        - 存储节点侧：
            
            - 计算时间主要花在构建索引数据库；通信时间与接收密文及标签有关。
                
            - 在 DB3（最大数据集）上，三种方案的通信和计算成本均升高；在所有数据集上，本方案的时间始终低于两条基线，因为不需要将索引条目哈希上链（Fig.3(b)）。
                
        - 链上 gas：
            
            - 本方案仅在外包时上链“客户端、存储节点、文件信息”等必要元数据，而基线方案还要为每个索引条目写入哈希。
                
            - Fig.3(c) 中，在 DB1–DB3 上，本方案的 gas 曲线远低于 baseline1、baseline2，差距随数据规模增大而扩大。
                
    3. **可验证搜索 + 完整性审计阶段**：
        
        - 客户端：
            
            - 本方案的搜索时间随搜索次数线性增加；与两条基线相比，客户端时间略高，因为本方案在查询时**现算**搜索令牌 (T = SE.Enc(m_k,w))，而基线方案将所有搜索令牌预先存储，本地查询时仅做查表（Fig.4(a)）。
                
        - 存储节点：
            
            - 存储节点时间主要由“索引查找 + 证明生成”构成；DB3 中单个关键字关联文件更多，因此三种方案的单次搜索时间都更高。
                
            - 由于本方案使用单一聚合证明同时覆盖搜索正确性与完整性，而两条基线需分别生成搜索证明和审计证明，本方案在三套数据集上均显著降低了存储节点时间开销（Fig.4(b)）。
                
        - 验证节点：
            
            - 验证其他节点提交的证明时，本方案只需一次配对验证即可完成搜索与完整性双重检查；基线方案需要两次验证，因此在 Fig.4(c) 中三条数据集曲线均显示出本方案明显更低的验证时间。
                
        - 链上 gas：
            
            - 搜索与审计阶段，上链数据包括搜索请求、文件标识符和对应证明。
                
            - Fig.4(d) 表明在三套数据集上，本方案的 gas 成本显著低于两条基线，尤其在 DB3 中差距最为明显，说明统一证明机制有效降低了搜索相关链上负担。
                

---

**致命局限**

1. **查询表达能力有限**：
    
    - 方案当前仅针对**单关键字搜索**，作者在“Limitations and future work”中明确指出这一点；对于多关键字查询，只能通过“提交多个单关键字请求 → 存储节点计算交/并集 → 为每个关键字分别发布关键字关联证明”的方式扩展，对链上证明条数造成线性放大。对于相似性搜索等复杂查询形式，现有结构无法直接支持，需要新的设计。
        
2. **部署层面的资源与激励约束**：
    
    - Section III-C 的讨论部分指出两点实际部署难题：
        
        1. **节点异构**：很多存储节点是资源受限的个人设备，面对加密搜索与统一证明生成任务，可能无法在规定审计周期内完成所有请求，因此需要 DSN 适当延长审计周期或调整负载分配。
            
        2. **激励缺失**：当前 DSN 通常只按存储容量奖励节点，没有针对执行加密搜索和结果验证的专门激励；在此机制下，一部分节点即使部署了该协议，也可能选择不承担搜索与验证任务。作者将“设计底层激励机制以鼓励节点执行加密搜索与验证”视为实际系统落地必须补齐的一环。
               
3. **针对侧信道攻击的防护依赖外部预处理**：
    
    - Section IV-B.5 承认：在存在背景知识的对手下，访问模式等侧信道仍可用于推断关键字或内容；文章仅指出可以在外包前采用已有“插入假关键字–文件对”的预处理方案模糊分布，但这需要客户端本地维护所有伪造对并在查询后过滤假阳性结果，引入额外存储和计算负担。作者没有在协议层整合新的泄露抑制机制，而是将其视为可选预处理步骤。
        

---
